
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for k0smotron.">
      
      
        <meta name="author" content="Mirantis, Inc.">
      
      
        <link rel="canonical" href="https://docs.k0smotron.io/head/capi-openstack/">
      
      
        <link rel="prev" href="../capi-hetzner/">
      
      
        <link rel="next" href="../capi-docker/">
      
      
      <link rel="icon" href="../img/k0s_social.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>OpenStack (HCP) - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XY3LK5RVBZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-XY3LK5RVBZ');
</script>

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cluster-api-openstack" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You are not currently viewing the documentation for the current stable release of k0smotron.
<a href="../..">
  <strong>Click here to go to the documentation of the current stable release.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL(".."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Documentation" class="md-header__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../img/k0s_social.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OpenStack (HCP)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/k0sproject/k0smotron" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Documentation" class="md-nav__button md-logo" aria-label="Documentation" data-md-component="logo">
      
  <img src="../img/k0s_social.png" alt="logo">

    </a>
    Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/k0sproject/k0smotron" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project status
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Usage
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../usage-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Standalone
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Standalone
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Create a cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../join-nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Join a worker node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../etcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Etcd configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ha/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    HA control planes with Kine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hcp-autoscaling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Autoscaling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Cluster API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Cluster API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cluster-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-controlplane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Plane
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-controlplane-bootstrap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Plane Bootstrap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-bootstrap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Worker Node Bootstrap
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-remote/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Machine Provider
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ingress-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingress support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ignition-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ignition support
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-clusterclass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ClusterClass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-machine-health-checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Health Checks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_10" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3_10" id="__nav_4_3_10_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3_10">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Software prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS (HCP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-aws-vm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS (VMs)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-hetzner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hetzner Cloud (HCP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    OpenStack (HCP)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    OpenStack (HCP)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparations" class="md-nav__link">
    <span class="md-ellipsis">
      Preparations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#management-cluster-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Management Cluster Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Setup Instructions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-openstack-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      1. OpenStack Credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-install-cinder-csi-on-management-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      2. Install Cinder CSI on Management Cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configure-and-deploy-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      3. Configure and Deploy the Cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment and Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment and Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the Cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-cluster-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor Cluster Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-cluster-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Cluster Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-deployment-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Deployment Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Post-Deployment Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieve-workload-cluster-access" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve Workload Cluster Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-openstack-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenStack Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-the-workload-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing the workload cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleting-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Deleting the cluster
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages-of-hosted-control-planes" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages of Hosted Control Planes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-docker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Docker (HCP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-kubevirt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    KubeVirt (HCP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-vsphere/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    vSphere
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-remotemachine-teleport/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Machine with Teleport
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-remotemachine-okta-asa/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Remote Machine with Okta ASA
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-use-oci-registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using OCI registry to pull k0s
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3_11" >
        
          
          <label class="md-nav__link" for="__nav_4_3_11" id="__nav_4_3_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_3_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3_11">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../capi-advanced/cloud-init/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud init customization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monitoring/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Monitoring
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Update
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Update
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update/update-standalone/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Standalone
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update/update-cluster-pod/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster API (HCP)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update/update-capi-cluster/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cluster API (VMs)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update/hcp-autopilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update workers (HCP)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../troubleshooting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../commercial-support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commercial Support
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Contributing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/contribute-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/dev-environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/contribute-workflow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/contribute-testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/release-process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release process
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../known-limitations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Known Limitations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11_1" >
        
          
          <label class="md-nav__link" for="__nav_11_1" id="__nav_11_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Custom resources
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_11_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11_1">
            <span class="md-nav__icon md-icon"></span>
            Custom resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resource-reference/bootstrap.cluster.x-k8s.io-v1beta1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    bootstrap.cluster.x-k8s.io/v1beta1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resource-reference/controlplane.cluster.x-k8s.io-v1beta1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    controlplane.cluster.x-k8s.io/v1beta1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resource-reference/infrastructure.cluster.x-k8s.io-v1beta1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    infrastructure.cluster.x-k8s.io/v1beta1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resource-reference/k0smotron.io-v1beta1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    k0smotron.io/v1beta1
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terminology/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terminology
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparations" class="md-nav__link">
    <span class="md-ellipsis">
      Preparations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Preparations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#management-cluster-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Management Cluster Requirements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#architecture-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Architecture Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      Setup Instructions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup Instructions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-openstack-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      1. OpenStack Credentials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-install-cinder-csi-on-management-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      2. Install Cinder CSI on Management Cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-configure-and-deploy-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      3. Configure and Deploy the Cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment-and-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      Deployment and Monitoring
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deployment and Monitoring">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy the Cluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-cluster-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Monitor Cluster Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#verify-cluster-creation" class="md-nav__link">
    <span class="md-ellipsis">
      Verify Cluster Creation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-deployment-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Deployment Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Post-Deployment Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#retrieve-workload-cluster-access" class="md-nav__link">
    <span class="md-ellipsis">
      Retrieve Workload Cluster Access
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-openstack-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenStack Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#accessing-the-workload-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Accessing the workload cluster
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deleting-the-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      Deleting the cluster
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conclusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages-of-hosted-control-planes" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages of Hosted Control Planes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cluster-api-openstack">Cluster API - OpenStack<a class="headerlink" href="#cluster-api-openstack" title="Permanent link">#</a></h1>
<p>This example demonstrates how k0smotron can be used with CAPO (Cluster API Provider OpenStack).</p>
<h2 id="preparations">Preparations<a class="headerlink" href="#preparations" title="Permanent link">#</a></h2>
<p>Before proceeding, ensure your management cluster meets the following requirements:</p>
<h3 id="management-cluster-requirements">Management Cluster Requirements<a class="headerlink" href="#management-cluster-requirements" title="Permanent link">#</a></h3>
<ul>
<li>A healthy Kubernetes cluster with cluster-admin access</li>
<li>Cluster API initialized with the OpenStack infrastructure provider:
  <div class="highlight"><pre><span></span><code>clusterctl<span class="w"> </span>init<span class="w"> </span>--infrastructure<span class="w"> </span>openstack
</code></pre></div></li>
<li>k0smotron installed (docs: https://docs.k0smotron.io/stable/install/#software-prerequisites)</li>
<li>A LoadBalancer implementation for the hosted control plane service (OpenStack CCM/Octavia or MetalLB)</li>
<li>OpenStack Cinder CSI driver installed and operational on the management cluster with:<ul>
<li>Valid OpenStack credentials secret in the <code>kube-system</code> namespace</li>
<li>A default StorageClass configured (if you install the openstack-cinder-csi helm chart, then the StorageClass will be created for you)</li>
</ul>
</li>
</ul>
<p>For more details on Cluster API Provider OpenStack see it's <a href="https://github.com/kubernetes-sigs/cluster-api-provider-openstack/tree/main/docs">docs</a>.</p>
<h3 id="architecture-considerations">Architecture Considerations<a class="headerlink" href="#architecture-considerations" title="Permanent link">#</a></h3>
<p>The hosted control plane etcd persistent volume resides on the management cluster, requiring functional storage. The workload cluster receives its own Cloud Controller Manager (CCM) and Container Storage Interface (CSI) drivers through k0s configuration extensions.</p>
<h2 id="setup-instructions">Setup Instructions<a class="headerlink" href="#setup-instructions" title="Permanent link">#</a></h2>
<h3 id="1-openstack-credentials">1. OpenStack Credentials<a class="headerlink" href="#1-openstack-credentials" title="Permanent link">#</a></h3>
<p>To be able to provision the OpenStack provider infrastructure, you will need to setup your OpenStack credentials.</p>
<p><strong>Get the openstack Clouds.yaml</strong></p>
<p>Download your “OpenStack clouds.yaml file” (Login -&gt; API Access -&gt; Download OpenStack clouds.yaml file)</p>
<p>Add "verify: false" to your clouds.yaml to avoid having the "x509: certificate signed by unknown authority" error.</p>
<p>More information here : <a href="https://cluster-api-openstack.sigs.k8s.io/topics/troubleshooting">cluster-api-troubleshooting</a></p>
<div class="highlight"><pre><span></span><code><span class="nt">clouds</span><span class="p">:</span>
<span class="w">  </span><span class="nt">openstack</span><span class="p">:</span>
<span class="w">    </span><span class="nt">insecure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">verify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">auth</span><span class="p">:</span>
<span class="w">      </span><span class="nt">auth_url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://keystone.yourCloud.yourOrganization.net/</span>
<span class="w">      </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yourUserName&quot;</span>
<span class="w">      </span><span class="nt">project_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yourProjectID&quot;</span>
<span class="w">      </span><span class="nt">project_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yourProjectName&quot;</span>
<span class="w">      </span><span class="nt">project_domain_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;yourProjectID&quot;</span>
<span class="w">      </span><span class="nt">user_domain_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Default&quot;</span>
<span class="w">      </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">YourPassWord</span>
<span class="w">    </span><span class="nt">region_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;RegionOne&quot;</span>
<span class="w">    </span><span class="nt">interface</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;public&quot;</span>
<span class="w">    </span><span class="nt">identity_api_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</code></pre></div>
<p>Create a base64-encoded OpenStack configuration file. The cluster manifest expects a secret named <code>openstack-cloud-config</code> in the <code>default</code> namespace with a <code>clouds.yaml</code> key.</p>
<p>Encode your <code>clouds.yaml</code> file:</p>
<p><strong>Linux:</strong>
<div class="highlight"><pre><span></span><code>base64<span class="w"> </span>-w0<span class="w"> </span>clouds.yaml<span class="w"> </span>&gt;<span class="w"> </span>clouds.yaml.b64
</code></pre></div></p>
<p><strong>macOS:</strong>
<div class="highlight"><pre><span></span><code>base64<span class="w"> </span>-b0<span class="w"> </span>clouds.yaml<span class="w"> </span>&gt;<span class="w"> </span>clouds.yaml.b64
</code></pre></div></p>
<p>Copy the single-line contents of <code>clouds.yaml.b64</code> and paste it into the cluster manifest at <code>data.clouds.yaml</code> (replace <code>&lt;BASE64_OF_clouds.yaml_HERE&gt;</code>).</p>
<h3 id="2-install-cinder-csi-on-management-cluster">2. Install Cinder CSI on Management Cluster<a class="headerlink" href="#2-install-cinder-csi-on-management-cluster" title="Permanent link">#</a></h3>
<p>Create the OpenStack credentials secret and install the Cinder CSI driver:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>openstack-cloud-config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-file<span class="o">=</span>clouds.yaml<span class="o">=</span>./clouds.yaml

helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>openstack<span class="w"> </span>https://kubernetes.github.io/cloud-provider-openstack/
helm<span class="w"> </span>repo<span class="w"> </span>update

helm<span class="w"> </span>upgrade<span class="w"> </span>--install<span class="w"> </span>openstack-csi<span class="w"> </span>openstack/openstack-cinder-csi<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>secret.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>secret.create<span class="o">=</span><span class="nb">false</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>secret.name<span class="o">=</span>openstack-cloud-config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>storageClass.enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>storageClass.name<span class="o">=</span>cinder-sc<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>storageClass.defaultClass<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>storageClass.allowVolumeExpansion<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set<span class="w"> </span>csi.plugin.nodePlugin.kubeletDir<span class="o">=</span>/var/lib/k0s/kubelet
</code></pre></div>
<p><em>Note: If you are using a kubernetes based management cluster, you will need to set the <code>csi.plugin.nodePlugin.kubeletDir</code> to <code>/var/lib/kubelet</code>.</em></p>
<p>Verify the installation:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>csidriver
kubectl<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>cinder
kubectl<span class="w"> </span>get<span class="w"> </span>sc
</code></pre></div>
<h3 id="3-configure-and-deploy-the-cluster">3. Configure and Deploy the Cluster<a class="headerlink" href="#3-configure-and-deploy-the-cluster" title="Permanent link">#</a></h3>
<p>Before applying the manifests, update the following fields:</p>
<ul>
<li>Update network, router, and subnet names in <code>OpenStackCluster</code> and <code>OpenStackMachineTemplate</code> to match your OpenStack environment</li>
<li>Insert the base64-encoded <code>clouds.yaml</code> content prepared in step 1</li>
</ul>
<h4 id="hosted-control-plane-cluster-manifests-openstack-hcp-clusteryaml">Hosted Control Plane Cluster Manifests (<code>openstack-hcp-cluster.yaml</code>)<a class="headerlink" href="#hosted-control-plane-cluster-manifests-openstack-hcp-clusteryaml" title="Permanent link">#</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">data</span><span class="p">:</span>
<span class="w">  </span><span class="nt">cacert</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">  </span><span class="nt">clouds.yaml</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;BASE64_OF_clouds.yaml_HERE&gt;</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-cloud-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="nt">pods</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cidrBlocks</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">10.244.0.0/16</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># Adjust accordingly</span>
<span class="w">    </span><span class="nt">serviceDomain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.local</span>
<span class="w">    </span><span class="nt">services</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cidrBlocks</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">10.96.0.0/12</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># Adjust accordingly</span>
<span class="w">  </span><span class="nt">controlPlaneRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K0smotronControlPlane</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-cp</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">  </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenStackCluster</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenStackCluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">externalNetwork</span><span class="p">:</span>
<span class="w">    </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">public</span>
<span class="w">  </span><span class="nt">identityRef</span><span class="p">:</span>
<span class="w">    </span><span class="nt">cloudName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-cloud-config</span>
<span class="w">    </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RegionOne</span>
<span class="w">  </span><span class="nt">network</span><span class="p">:</span>
<span class="w">    </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-clusterapi-cluster-default-capo-test</span>
<span class="w">  </span><span class="nt">router</span><span class="p">:</span>
<span class="w">    </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-clusterapi-cluster-default-capo-test</span>
<span class="w">  </span><span class="nt">subnets</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-clusterapi-cluster-default-capo-test</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MachineDeployment</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-md</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">cluster.x-k8s.io/cluster-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="nt">cluster.x-k8s.io/cluster-name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">bootstrap</span><span class="p">:</span>
<span class="w">        </span><span class="nt">configRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.cluster.x-k8s.io/v1beta1</span>
<span class="w">          </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K0sWorkerConfigTemplate</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-machine-config</span>
<span class="w">          </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">clusterName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster</span>
<span class="w">      </span><span class="nt">infrastructureRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta1</span>
<span class="w">        </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenStackMachineTemplate</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-mt</span>
<span class="w">        </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.32.6</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">infrastructure.cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenStackMachineTemplate</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-mt</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">flavor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">m1.medium</span>
<span class="w">      </span><span class="nt">identityRef</span><span class="p">:</span>
<span class="w">        </span><span class="nt">cloudName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-cloud-config</span>
<span class="w">        </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RegionOne</span>
<span class="w">      </span><span class="nt">image</span><span class="p">:</span>
<span class="w">        </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-22.04-x86_64</span>
<span class="w">      </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">network</span><span class="p">:</span>
<span class="w">          </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s-clusterapi-cluster-default-capo-test</span>
<span class="w">      </span><span class="nt">securityGroups</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">filter</span><span class="p">:</span>
<span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controlplane.cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K0smotronControlPlane</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-cp</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">controllerPlaneFlags</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--enable-cloud-provider=true</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--debug=true</span>
<span class="w">  </span><span class="nt">etcd</span><span class="p">:</span>
<span class="w">    </span><span class="nt">autoDeletePVCs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quay.io/k0sproject/etcd:v3.5.13</span>
<span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/k0sproject/k0s:v1.32.6-k0s.0</span><span class="w">  </span><span class="c1"># pinned GHCR tag to avoid rate limits with docker hub</span>
<span class="w">  </span><span class="nt">k0sConfig</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0s.k0sproject.io/v1beta1</span>
<span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterConfig</span>
<span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k0s</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">extensions</span><span class="p">:</span>
<span class="w">        </span><span class="nt">helm</span><span class="p">:</span>
<span class="w">          </span><span class="nt">charts</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">chartname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack/openstack-cloud-controller-manager</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-ccm</span>
<span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="w">            </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">            </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">secret:</span>
<span class="w">                </span><span class="no">enabled: true</span>
<span class="w">                </span><span class="no">name: openstack-cloud-config</span>
<span class="w">                </span><span class="no">create: false</span>
<span class="w">              </span><span class="no">nodeSelector: null</span>
<span class="w">              </span><span class="no">tolerations:</span>
<span class="w">                </span><span class="no">- key: node.cloudprovider.kubernetes.io/uninitialized</span>
<span class="w">                  </span><span class="no">value: &quot;true&quot;</span>
<span class="w">                  </span><span class="no">effect: NoSchedule</span>
<span class="w">                </span><span class="no">- key: node-role.kubernetes.io/control-plane</span>
<span class="w">                  </span><span class="no">effect: NoSchedule</span>
<span class="w">                </span><span class="no">- key: node-role.kubernetes.io/master</span>
<span class="w">                  </span><span class="no">effect: NoSchedule</span>
<span class="w">              </span><span class="no">extraEnv:</span>
<span class="w">                </span><span class="no">- name: OS_CCM_REGIONAL</span>
<span class="w">                  </span><span class="no">value: &quot;true&quot;</span>
<span class="w">              </span><span class="no">extraVolumes:</span>
<span class="w">                </span><span class="no">- name: flexvolume-dir</span>
<span class="w">                  </span><span class="no">hostPath:</span>
<span class="w">                    </span><span class="no">path: /usr/libexec/kubernetes/kubelet-plugins/volume/exec</span>
<span class="w">                </span><span class="no">- name: k8s-certs</span>
<span class="w">                  </span><span class="no">hostPath:</span>
<span class="w">                    </span><span class="no">path: /etc/kubernetes/pki</span>
<span class="w">              </span><span class="no">extraVolumeMounts:</span>
<span class="w">                </span><span class="no">- name: flexvolume-dir</span>
<span class="w">                  </span><span class="no">mountPath: /usr/libexec/kubernetes/kubelet-plugins/volume/exec</span>
<span class="w">                  </span><span class="no">readOnly: true</span>
<span class="w">                </span><span class="no">- name: k8s-certs</span>
<span class="w">                  </span><span class="no">mountPath: /etc/kubernetes/pki</span>
<span class="w">                  </span><span class="no">readOnly: true</span>
<span class="w">            </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.31.1</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">chartname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack/openstack-cinder-csi</span>
<span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-csi</span>
<span class="w">            </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class="w">            </span><span class="nt">order</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
<span class="w">            </span><span class="nt">values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">              </span><span class="no">storageClass:</span>
<span class="w">                </span><span class="no">enabled: true</span>
<span class="w">                </span><span class="no">delete:</span>
<span class="w">                  </span><span class="no">isDefault: true</span>
<span class="w">                  </span><span class="no">allowVolumeExpansion: true</span>
<span class="w">                </span><span class="no">retain:</span>
<span class="w">                  </span><span class="no">isDefault: false</span>
<span class="w">                  </span><span class="no">allowVolumeExpansion: false</span>
<span class="w">              </span><span class="no">secret:</span>
<span class="w">                </span><span class="no">enabled: true</span>
<span class="w">                </span><span class="no">name: openstack-cloud-config</span>
<span class="w">                </span><span class="no">create: false   # set to true if you want the chart to create the Secret in workload cluster</span>
<span class="w">              </span><span class="no">csi:</span>
<span class="w">                </span><span class="no">plugin:</span>
<span class="w">                  </span><span class="no">nodePlugin:</span>
<span class="w">                    </span><span class="no">kubeletDir: /var/lib/k0s/kubelet   # workload cluster nodes run k0s</span>
<span class="w">            </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.31.2</span>
<span class="w">          </span><span class="nt">repositories</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack</span>
<span class="w">            </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.github.io/cloud-provider-openstack/</span>
<span class="w">      </span><span class="nt">network</span><span class="p">:</span>
<span class="w">        </span><span class="nt">calico</span><span class="p">:</span>
<span class="w">          </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vxlan</span>
<span class="w">        </span><span class="nt">clusterDomain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.local</span>
<span class="w">        </span><span class="nt">podCIDR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.244.0.0/16</span>
<span class="w">        </span><span class="nt">provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">calico</span>
<span class="w">        </span><span class="nt">serviceCIDR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.96.0.0/12</span>
<span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">  </span><span class="nt">service</span><span class="p">:</span>
<span class="w">    </span><span class="nt">apiPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6443</span>
<span class="w">    </span><span class="nt">konnectivityPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8132</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
<span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">K0sWorkerConfigTemplate</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">openstack-hcp-cluster-machine-config</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="nt">args</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--enable-cloud-provider</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--kubelet-extra-args=&quot;--cloud-provider=external&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--debug=true</span>
<span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1.32.6+k0s.0</span>
</code></pre></div>
<h2 id="deployment-and-monitoring">Deployment and Monitoring<a class="headerlink" href="#deployment-and-monitoring" title="Permanent link">#</a></h2>
<h3 id="deploy-the-cluster">Deploy the Cluster<a class="headerlink" href="#deploy-the-cluster" title="Permanent link">#</a></h3>
<p>Apply the cluster manifest:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>openstack-hcp-cluster.yaml
</code></pre></div>
<h3 id="monitor-cluster-creation">Monitor Cluster Creation<a class="headerlink" href="#monitor-cluster-creation" title="Permanent link">#</a></h3>
<p>Monitor the hosted control plane deployment:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Watch etcd PVC binding and pod startup on the management cluster</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>get<span class="w"> </span>pvc
kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-w

<span class="c1"># Verify the LoadBalancer service receives an external IP address</span>
kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>openstack-hcp-cluster-cp<span class="w"> </span>-o<span class="w"> </span>wide
</code></pre></div>
<p>Expected components in the <code>default</code> namespace:
- <code>kmc-openstack-hcp-cluster-etcd-0</code> pod in Running state
- <code>kmc-openstack-hcp-cluster-0</code> (controller) pod in Running state<br />
- <code>openstack-hcp-cluster-cp</code> service (LoadBalancer) with an assigned EXTERNAL-IP</p>
<p>The control plane will become operational within a few minutes, followed by worker nodes joining the cluster.</p>
<h3 id="verify-cluster-creation">Verify Cluster Creation<a class="headerlink" href="#verify-cluster-creation" title="Permanent link">#</a></h3>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>cluster,machine,kmc

NAME<span class="w">                                   </span>CLUSTERCLASS<span class="w">   </span>PHASE<span class="w">         </span>AGE<span class="w">     </span>VERSION
cluster.cluster.x-k8s.io/cluster-openstack<span class="w">                     </span>Provisioned<span class="w">   </span>135m

NAME<span class="w">                                                          </span>CLUSTER<span class="w">       </span>NODENAME<span class="w">   </span>PROVIDERID<span class="w">                                          </span>PHASE<span class="w">         </span>AGE<span class="w">     </span>VERSION
machine.cluster.x-k8s.io/cluster-openstack-worker-vms-drjzw-7699d<span class="w">      </span>cluster2<span class="w">                 </span>openstack:///f8f41440-36e6-4e9c-b941-16b95ee95277<span class="w">   </span>Provisioned<span class="w">   </span>135m
</code></pre></div>
<p>You can also check the status of the cluster deployment with <code>clusterctl</code>:
<div class="highlight"><pre><span></span><code>❯<span class="w"> </span>clusterctl<span class="w"> </span>describe<span class="w"> </span>cluster<span class="w"> </span>cluster3
NAME<span class="w">                                                                     </span>READY<span class="w">  </span>SEVERITY<span class="w">  </span>REASON<span class="w">                       </span>SINCE<span class="w">  </span>MESSAGE
Cluster/cluster3<span class="w">                                                         </span>True<span class="w">                                          </span>5d4h
├─ClusterInfrastructure<span class="w"> </span>-<span class="w"> </span>OpenStackCluster/cluster3
├─ControlPlane<span class="w"> </span>-<span class="w"> </span>K0smotronControlPlane/cluster3
└─Workers
<span class="w">    </span>└─Machine/cluster3-worker-vms-929sw-nkhht<span class="w">                            </span>True<span class="w">                                          </span>5d4h
<span class="w">      </span>└─BootstrapConfig<span class="w"> </span>-<span class="w"> </span>K0sWorkerConfig/cluster3-machine-config-tlg78
</code></pre></div></p>
<h2 id="post-deployment-configuration">Post-Deployment Configuration<a class="headerlink" href="#post-deployment-configuration" title="Permanent link">#</a></h2>
<h3 id="retrieve-workload-cluster-access">Retrieve Workload Cluster Access<a class="headerlink" href="#retrieve-workload-cluster-access" title="Permanent link">#</a></h3>
<p>Obtain the workload cluster kubeconfig:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>get<span class="w"> </span>secrets<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>kubeconfig
kubectl<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>&lt;NAME&gt;<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.value}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="w"> </span>&gt;<span class="w"> </span>workload-cluster.kubeconfig
</code></pre></div>
<p>You can also save it to disk and/or import to your favorite tooling like <a href="https://k8slens.dev">Lens</a>.</p>
<h3 id="configure-openstack-integration">Configure OpenStack Integration<a class="headerlink" href="#configure-openstack-integration" title="Permanent link">#</a></h3>
<p>If the cluster manifest has <code>create: false</code> for secrets (as shown in the example), manually create the OpenStack credentials in the workload cluster:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>--kubeconfig<span class="w"> </span>workload-cluster.kubeconfig<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>openstack-cloud-config<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--from-file<span class="o">=</span>clouds.yaml<span class="o">=</span>./clouds.yaml
</code></pre></div>
<h3 id="accessing-the-workload-cluster">Accessing the workload cluster<a class="headerlink" href="#accessing-the-workload-cluster" title="Permanent link">#</a></h3>
<p>Validate the workload cluster components and nodes:</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>--kubeconfig<span class="w"> </span>workload-cluster.kubeconfig<span class="w"> </span>get<span class="w"> </span>nodes
kubectl<span class="w"> </span>--kubeconfig<span class="w"> </span>workload-cluster.kubeconfig<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>kube-system
</code></pre></div>
<h2 id="deleting-the-cluster">Deleting the cluster<a class="headerlink" href="#deleting-the-cluster" title="Permanent link">#</a></h2>
<p>For cluster deletion, do <strong>NOT</strong> use <code>kubectl delete -f openstack-hcp-cluster.yaml</code> as that can result in orphan resources. Instead, delete the top level <code>Cluster</code> object. This approach ensures the proper sequence in deleting all child resources, effectively avoiding orphan resources.</p>
<p>To do that, you can use the command <code>kubectl delete cluster openstack-hcp-cluster</code></p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">#</a></h2>
<p>This guide demonstrated how to deploy a Kubernetes cluster on OpenStack using a hosted control plane architecture with Cluster API Provider OpenStack (CAPO) and k0smotron. The key benefits of this approach include:</p>
<h3 id="advantages-of-hosted-control-planes">Advantages of Hosted Control Planes<a class="headerlink" href="#advantages-of-hosted-control-planes" title="Permanent link">#</a></h3>
<ul>
<li><strong>Resource Efficiency</strong>: Control plane components run as pods on the management cluster, reducing the infrastructure footprint</li>
<li><strong>Simplified Management</strong>: Centralized control plane management across multiple workload clusters</li>
<li><strong>High Availability</strong>: Leverages the management cluster's infrastructure for control plane resilience</li>
<li><strong>Cost Optimization</strong>: Eliminates the need for dedicated control plane nodes in each workload cluster</li>
</ul>
<p>For production deployments, ensure proper sizing of the management cluster to handle multiple hosted control planes and their associated workloads.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 k0sproject a Series of LF Projects, LLC. For website terms of use, trademark policy and other project policies please see lfprojects.org/policies/. - All rights reserved.
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/k0sproject/k0smotron" target="_blank" rel="noopener" title="k0smotron on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="https://k0smotron.io/" target="_blank" rel="noopener" title="k0smotron Website" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M419.5 96c-16.6 0-32.7 4.5-46.8 12.7-15.8-16-34.2-29.4-54.5-39.5 28.2-24 64.1-37.2 101.3-37.2C505.9 32 576 102 576 188.5c0 41.5-16.5 81.3-45.8 110.6l-71.1 71.1C429.8 399.5 390 416 348.5 416 262.1 416 192 346 192 259.5c0-1.5 0-3 .1-4.5.5-17.7 15.2-31.6 32.9-31.1s31.6 15.2 31.1 32.9v2.6c0 51.1 41.4 92.5 92.5 92.5 24.5 0 48-9.7 65.4-27.1l71.1-71.1c17.3-17.3 27.1-40.9 27.1-65.4 0-51.1-41.4-92.5-92.5-92.5zm-144.3 77.3c-1.9-.8-3.8-1.9-5.5-3.1-12.6-6.5-27-10.2-42.1-10.2-24.5 0-48 9.7-65.4 27.1l-71.1 71.1C73.8 275.5 64 299.1 64 323.6c0 51.1 41.4 92.5 92.5 92.5 16.5 0 32.6-4.4 46.7-12.6 15.8 16 34.2 29.4 54.6 39.5-28.2 23.9-64 37.2-101.3 37.2C70.1 480.2 0 410.2 0 323.7c0-41.5 16.5-81.3 45.8-110.6l71.1-71.1c29.3-29.3 69.1-45.8 110.6-45.8 86.6 0 156.5 70.6 156.5 156.9v3.9c-.4 17.7-15.1 31.6-32.8 31.2s-31.6-15.1-31.2-32.8v-2.3c0-33.7-18-63.3-44.8-79.6z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["toc.autohide", "search.suggest", "search.highlight", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>